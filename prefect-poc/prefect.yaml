# Welcome to your prefect.yaml file! You can use this file for storing and managing
# configuration for deploying your flows. We recommend committing this file to source
# control along with your flow code.

# Generic metadata about this project
name: prefect-poc
prefect-version: 3.1.13

# build section allows you to manage and build docker images
build:

# push section allows you to manage if and how this project is uploaded to remote locations
push:

# pull section allows you to provide instructions for cloning this project in remote locations
pull:
  - prefect.deployments.steps.set_working_directory:
      # Use local current directory
      directory: "{{ $PWD }}"

definitions:
  work_pools:
    my_work_pool: &my_work_pool
      name: poc-worker
      work_queue_name: default
      job_variables: {}
  schedules:
    every_two_minutes: &every_two_minutes
      cron: "*/2 * * * *"
  entrypoint: &run_docker_entrypoint src/prefect_poc/run_docker.py:run_docker

# the deployments section allows you to provide configuration for deploying flows
deployments:
  - name: first
    version:
    tags: ["poc"]
    description:
    schedules:
      - *every_two_minutes
    concurrency_limit: 2
    entrypoint: *run_docker_entrypoint
    parameters: { input_data: I'm running from Prefect }
    work_pool: *my_work_pool
  - name: second
    version:
    tags: ["poc"]
    description:
    schedules:
      - *every_two_minutes
    concurrency_limit: 2
    flow_name:
    entrypoint: *run_docker_entrypoint
    parameters: { input_data: Running again }
    work_pool: *my_work_pool
  - name: third
    version:
    tags: ["poc"]
    description:
    schedules:
      - *every_two_minutes
    concurrency_limit: 2
    flow_name:
    entrypoint: *run_docker_entrypoint
    parameters: { input_data: third time to test concurrency }
    work_pool: *my_work_pool
